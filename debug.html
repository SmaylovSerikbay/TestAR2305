<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–∞–º–µ—Ä—ã</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #000;
            color: #fff;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .pass { background: #28a745; }
        .fail { background: #dc3545; }
        .warn { background: #ffc107; color: #000; }
        
        #video {
            width: 100%;
            max-width: 400px;
            border: 2px solid #fff;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
        }
        
        button:active {
            background: #0056b3;
        }
        
        #log {
            background: #333;
            color: #0f0;
            font-family: monospace;
            padding: 10px;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            margin: 20px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ AR</h1>
    
    <div id="tests">
        <div id="test-results"></div>
    </div>
    
    <button onclick="runTests()">üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã</button>
    <button onclick="testCamera()">üì∑ –¢–µ—Å—Ç –∫–∞–º–µ—Ä—ã</button>
    <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    
    <div id="log"></div>
    
    <video id="video" style="display: none;" autoplay muted playsinline></video>
    
    <script>
        // –õ–æ–≥ —Ñ—É–Ω–∫—Ü–∏—è
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#fff';
            logDiv.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function addTestResult(name, passed, details = '') {
            const results = document.getElementById('test-results');
            const className = passed ? 'pass' : 'fail';
            const emoji = passed ? '‚úÖ' : '‚ùå';
            results.innerHTML += `
                <div class="test-result ${className}">
                    ${emoji} ${name} ${details}
                </div>
            `;
        }
        
        function runTests() {
            document.getElementById('test-results').innerHTML = '';
            log('üîÑ –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤...', 'info');
            
            // –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤—ã–µ API
            log('–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤—ã—Ö API...', 'info');
            const hasNavigator = typeof navigator !== 'undefined';
            addTestResult('Navigator API', hasNavigator);
            log(`Navigator –¥–æ—Å—Ç—É–ø–µ–Ω: ${hasNavigator}`, hasNavigator ? 'success' : 'error');
            
            // –¢–µ—Å—Ç 2: MediaDevices API
            log('–¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ MediaDevices API...', 'info');
            const hasMediaDevices = !!(navigator && navigator.mediaDevices);
            addTestResult('MediaDevices API', hasMediaDevices);
            log(`MediaDevices –¥–æ—Å—Ç—É–ø–µ–Ω: ${hasMediaDevices}`, hasMediaDevices ? 'success' : 'error');
            
            // –¢–µ—Å—Ç 3: getUserMedia
            log('–¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ getUserMedia...', 'info');
            const hasGetUserMedia = !!(navigator && navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
            addTestResult('getUserMedia API', hasGetUserMedia);
            log(`getUserMedia –¥–æ—Å—Ç—É–ø–µ–Ω: ${hasGetUserMedia}`, hasGetUserMedia ? 'success' : 'error');
            
            // –¢–µ—Å—Ç 4: HTTPS/Secure Context
            log('–¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞...', 'info');
            const isSecureContext = window.isSecureContext || location.protocol === 'https:' || location.hostname === 'localhost';
            addTestResult('Secure Context (HTTPS)', isSecureContext);
            log(`–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: ${isSecureContext}`, isSecureContext ? 'success' : 'error');
            
            // –¢–µ—Å—Ç 5: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ
            log('–¢–µ—Å—Ç 5: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ...', 'info');
            if (navigator) {
                log(`User Agent: ${navigator.userAgent}`, 'info');
                log(`Platform: ${navigator.platform}`, 'info');
                log(`Vendor: ${navigator.vendor}`, 'info');
                log(`Cookie enabled: ${navigator.cookieEnabled}`, 'info');
                log(`Online: ${navigator.onLine}`, 'info');
            }
            
            // –¢–µ—Å—Ç 6: –†–∞–∑—Ä–µ—à–µ–Ω–∏—è
            if (navigator.permissions) {
                log('–¢–µ—Å—Ç 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –∫–∞–º–µ—Ä—ã...', 'info');
                navigator.permissions.query({ name: 'camera' }).then(result => {
                    log(`–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã: ${result.state}`, result.state === 'granted' ? 'success' : 'error');
                    addTestResult('Camera Permission', result.state === 'granted', `(${result.state})`);
                }).catch(err => {
                    log(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π: ${err.message}`, 'error');
                });
            } else {
                log('Permissions API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warn');
            }
            
            // –¢–µ—Å—Ç 7: Enumerate devices
            if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
                log('–¢–µ—Å—Ç 7: –ü–æ–∏—Å–∫ –∫–∞–º–µ—Ä...', 'info');
                navigator.mediaDevices.enumerateDevices().then(devices => {
                    const cameras = devices.filter(device => device.kind === 'videoinput');
                    log(`–ù–∞–π–¥–µ–Ω–æ –∫–∞–º–µ—Ä: ${cameras.length}`, cameras.length > 0 ? 'success' : 'error');
                    cameras.forEach((camera, index) => {
                        log(`–ö–∞–º–µ—Ä–∞ ${index + 1}: ${camera.label || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}`, 'info');
                    });
                    addTestResult('Cameras Found', cameras.length > 0, `(${cameras.length} –∫–∞–º–µ—Ä)`);
                }).catch(err => {
                    log(`–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤: ${err.message}`, 'error');
                });
            }
            
            log('‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
        }
        
        async function testCamera() {
            log('üì∑ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –∫–∞–º–µ—Ä—ã...', 'info');
            const video = document.getElementById('video');
            
            try {
                // –¢–µ—Å—Ç —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
                log('–ü–æ–ø—ã—Ç–∫–∞ 1: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...', 'info');
                let stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                video.style.display = 'block';
                log('‚úÖ –ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏!', 'success');
                addTestResult('Basic Camera Access', true, '(–ª—é–±–∞—è –∫–∞–º–µ—Ä–∞)');
                
                // –û—Å—Ç–∞–Ω–æ–≤–∏–º –ø–æ—Ç–æ–∫ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞
                stream.getTracks().forEach(track => track.stop());
                
                // –¢–µ—Å—Ç —Å –∑–∞–¥–Ω–µ–π –∫–∞–º–µ—Ä–æ–π
                log('–ü–æ–ø—ã—Ç–∫–∞ 2: –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞...', 'info');
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                video.srcObject = stream;
                log('‚úÖ –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                addTestResult('Back Camera Access', true, '(environment)');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ${error.name} - ${error.message}`, 'error');
                addTestResult('Camera Access', false, `(${error.name})`);
                
                // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫
                if (error.name === 'NotAllowedError') {
                    log('üö´ –î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–ø—Ä–µ—â–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º', 'error');
                    log('üí° –†–µ—à–µ–Ω–∏–µ: –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞', 'warn');
                } else if (error.name === 'NotFoundError') {
                    log('üì∑ –ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    log('üí° –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã', 'warn');
                } else if (error.name === 'NotSupportedError') {
                    log('üö´ –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ', 'error');
                    log('üí° –†–µ—à–µ–Ω–∏–µ: –û–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome/Safari', 'warn');
                } else if (error.name === 'NotReadableError') {
                    log('üîí –ö–∞–º–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º', 'error');
                    log('üí° –†–µ—à–µ–Ω–∏–µ: –ó–∞–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –∫–∞–º–µ—Ä—É', 'warn');
                } else if (error.name === 'SecurityError') {
                    log('üîí –û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', 'error');
                    log('üí° –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –∏–ª–∏ localhost', 'warn');
                }
                
                // –ü–æ–ø—Ä–æ–±—É–µ–º —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞–º–µ—Ä—É
                try {
                    log('–ü–æ–ø—ã—Ç–∫–∞ 3: –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞...', 'info');
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: 'user' }
                    });
                    video.srcObject = stream;
                    video.style.display = 'block';
                    log('‚úÖ –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                    addTestResult('Front Camera Access', true, '(user)');
                } catch (frontError) {
                    log(`‚ùå –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${frontError.message}`, 'error');
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', (e) => {
            log(`‚ùå JavaScript –æ—à–∏–±–∫–∞: ${e.message} –≤ ${e.filename}:${e.lineno}`, 'error');
        });
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
        window.addEventListener('load', () => {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...', 'info');
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html> 