<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Simple AR Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #video {
            width: 100vw;
            height: 100vh;
            object-fit: cover;
        }
        
        .overlay {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            z-index: 100;
        }
        
        .controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
        .btn {
            flex: 1;
            background: #007bff;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .btn:active {
            background: #0056b3;
        }
        
        .object {
            position: fixed;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            z-index: 50;
            animation: pulse 2s infinite;
        }
        
        .cube { background: #ff6b6b; border-radius: 0; }
        .sphere { background: #4ecdc4; }
        .cylinder { background: #45b7d1; border-radius: 25px 25px 50px 50px; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        #debug {
            position: fixed;
            bottom: 100px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #00ff00;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border-radius: 5px;
            max-height: 100px;
            overflow-y: auto;
            z-index: 99;
        }
    </style>
</head>
<body>
    <video id="video" autoplay muted playsinline></video>
    
    <div class="overlay">
        <div><strong>–ü—Ä–æ—Å—Ç–æ–π AR —Ç–µ—Å—Ç</strong></div>
        <div id="status">–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...</div>
    </div>
    
    <div id="debug"></div>
    
    <div class="controls">
        <button class="btn" onclick="addObject('cube')">üü• –ö—É–±</button>
        <button class="btn" onclick="addObject('sphere')">üîµ –°—Ñ–µ—Ä–∞</button>
        <button class="btn" onclick="addObject('cylinder')">üü¶ –¶–∏–ª–∏–Ω–¥—Ä</button>
        <button class="btn" onclick="clearObjects()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>

    <script>
        let objectCounter = 0;
        const objects = [];
        
        function log(message) {
            const debug = document.getElementById('debug');
            const time = new Date().toLocaleTimeString();
            debug.innerHTML += `<div>${time}: ${message}</div>`;
            debug.scrollTop = debug.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            log('Status: ' + message);
        }
        
        async function startCamera() {
            try {
                log('üîÑ –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...');
                
                const constraints = {
                    video: {
                        facingMode: 'environment', // –ó–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('video');
                video.srcObject = stream;
                
                video.onloadedmetadata = () => {
                    log('‚úÖ –ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞');
                    updateStatus('‚úÖ –ö–∞–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ù–∞–∂–∏–º–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤');
                };
                
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: ' + error.message);
                updateStatus('‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ' + error.message);
                
                // –ü–æ–ø—Ä–æ–±—É–µ–º –ª—é–±—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –∫–∞–º–µ—Ä—É
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    const video = document.getElementById('video');
                    video.srcObject = stream;
                    log('‚úÖ –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞');
                    updateStatus('‚úÖ –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!');
                } catch (fallbackError) {
                    log('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + fallbackError.message);
                    updateStatus('‚ùå –ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: ' + fallbackError.message);
                }
            }
        }
        
        function addObject(type) {
            try {
                log(`üéØ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞: ${type}`);
                
                const object = document.createElement('div');
                object.className = `object ${type}`;
                object.id = `obj_${objectCounter++}`;
                
                // –†–∞–∑–º–µ—â–∞–µ–º –≤ —Å–ª—É—á–∞–π–Ω–æ–º –º–µ—Å—Ç–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                const x = Math.random() * (window.innerWidth - 50);
                const y = Math.random() * (window.innerHeight - 200) + 100;
                
                object.style.left = x + 'px';
                object.style.top = y + 'px';
                
                document.body.appendChild(object);
                objects.push(object);
                
                updateStatus(`‚úÖ ${type} –¥–æ–±–∞–≤–ª–µ–Ω! –û–±—ä–µ–∫—Ç–æ–≤: ${objects.length}`);
                log(`‚úÖ –û–±—ä–µ–∫—Ç —Ä–∞–∑–º–µ—â–µ–Ω –≤ –ø–æ–∑–∏—Ü–∏–∏ (${x.toFixed(0)}, ${y.toFixed(0)})`);
                
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞: ' + error.message);
            }
        }
        
        function clearObjects() {
            try {
                objects.forEach(obj => {
                    if (obj.parentNode) {
                        obj.parentNode.removeChild(obj);
                    }
                });
                objects.length = 0;
                updateStatus('üóëÔ∏è –í—Å–µ –æ–±—ä–µ–∫—Ç—ã —É–¥–∞–ª–µ–Ω—ã');
                log('üóëÔ∏è –û–±—ä–µ–∫—Ç—ã –æ—á–∏—â–µ–Ω—ã');
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: ' + error.message);
            }
        }
        
        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ
        function getBrowserInfo() {
            const info = {
                userAgent: navigator.userAgent,
                vendor: navigator.vendor,
                platform: navigator.platform,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                mediaDevices: !!navigator.mediaDevices,
                getUserMedia: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)
            };
            
            log('üì± –ë—Ä–∞—É–∑–µ—Ä: ' + navigator.userAgent.split(' ').pop());
            log('üì± –ö–∞–º–µ—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è: ' + (info.getUserMedia ? '–î–∞' : '–ù–µ—Ç'));
            
            return info;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', (e) => {
            log('‚ùå –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞: ' + e.message);
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            log('üì± DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
            getBrowserInfo();
            startCamera();
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
        document.addEventListener('touchmove', (e) => {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('gesturestart', (e) => {
            e.preventDefault();
        });
    </script>
</body>
</html> 